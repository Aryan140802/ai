+--------+---------------------------------------------------------+----------+---------------------+------------+-----------------------------------------------------------+-------------------------------------------------------------+---------------------------------------+----------------------+---------------------------+----------------------------+-----------------------------------------------------------+-------------------------------+--------------------+-------------------+------------------------+------------------------------+--------------------+------------------------------------------------------------------------------------+----------------+------+------------+------------+
| Far_Id | Subject                                                 | Status   | Created             | Expires    | Requested_Source                                          | Requested_Destination                                       | Requested_Service                     | Requested_Source_NAT | Requested_Destination_NAT | Requested_Port_Translation | Change_Source                                             | Change_Destination            | Change_Service     | Change_Source_NAT | Change_Destination_NAT | Translated_Destination       | Translated_Service | Dependent_application                                                              | Permanent_Rule | ZONE | Created_op | Expires_op |
+--------+---------------------------------------------------------+----------+---------------------+------------+-----------------------------------------------------------+-------------------------------------------------------------+---------------------------------------+----------------------+---------------------------+----------------------------+-----------------------------------------------------------+-------------------------------+--------------------+-------------------+------------------------+------------------------------+--------------------+------------------------------------------------------------------------------------+----------------+------+------------+------------+
|    175 | Connection  between EIS PROD/DR and CRM PROD/DR Servers | rejected | 2020-03-02 18:57:19 | 2020-03-11 | 10.176.1.96 - 10.176.1.103,10.191.171.96 - 10.191.171.103 | 10.189.192.52, 10.209.160.180,10.209.160.180, 10.189.192.52 | https                                 |                      |                           |                            | 10.176.1.96 - 10.176.1.103,10.191.171.96 - 10.191.171.103 | 10.189.192.52, 10.209.160.180 | tcp/443            |                   |                        | 10.189.192.52,10.209.160.180 | tcp/443            | CRM                                                                                | No             | PROD | NULL       | NULL       |
|    186 | For Communication between EIS and DCMS servers for IVR  | rejected | 2020-03-03 13:25:25 |            | 10.191.172.44, 10.191.172.45,10.191.172.41                | 10.189.40.5-10.189.40.6                                     | tcp/7030, tcp/7029,tcp/7029, tcp/7030 |                      |                           |                            | 10.191.172.44, 10.191.172.45,10.191.172.41                | 10.189.40.5-10.189.40.6       | tcp/7029, tcp/7030 |                   |                        | 10.189.40.5-10.189.40.6      | tcp/7029,tcp/7030  | CRM                                                                                | No             | UAT  | NULL       | NULL       |
|    187 | For Communication between EIS and DCMS servers for IVR  | rejected | 2020-03-03 14:30:55 |            | 10.191.172.44, 10.191.172.45,10.191.172.41                | 10.189.40.5-10.189.40.6                                     | tcp/7030, tcp/7029,tcp/7029, tcp/7030 |                      |                           |                            | 10.191.172.44, 10.191.172.45,10.191.172.41                | 10.189.40.5-10.189.40.6       | tcp/7029, tcp/7030 |                   |                        | 10.189.40.5-10.189.40.6      | tcp/7029,tcp/7030  | CRM                                                                                | No             | UAT  | NULL       | NULL       |
|    254 | UAT FAR EIS DCMS                                        | resolved | 2020-03-05 11:43:05 | 2020-05-31 | 10.191.172.44-10.191.172.45,10.191.172.41                 | 10.189.40.6, 10.189.40.5,10.189.40.5, 10.189.40.6           | tcp/7030, tcp/7029,tcp/7029, tcp/7030 |                      |                           |                            | 10.191.172.44-10.191.172.45,10.191.172.41                 | 10.189.40.5, 10.189.40.6      | tcp/7029, tcp/7030 |                   |                        | 10.189.40.5-10.189.40.6      | tcp/7029,tcp/7030  | UAT & UX, YONO 2.0 Department, CMP & SCFU, Mobile Banking, YONO Business, INB, ATM | No             | UAT  | NULL       | NULL       |
|    487 | EIS-UAT                                                 | resolved | 2020-03-11 16:53:58 | 2020-05-10 | 10.0.13.160, 10.0.13.98                                   | 10.191.172.38, 10.191.172.35                                | TCP/8443, TCP/22                      |                      |                           |                            | 10.0.13.98, 10.0.13.160                                   | 10.191.172.35, 10.191.172.38  | tcp/22, tcp/8443   |                   |                        | 10.191.172.35,10.191.172.38  | tcp/22,tcp/8443    | EIS                                                                                | No             | UAT  | NULL       | NULL       |
+--------+---------------------------------------------------------+----------+---------------------+------------+-----------------------------------------------------------+-------------------------------------------------------------+---------------------------------------+----------------------+---------------------------+----------------------------+-----------------------------------------------------------+-------------------------------+--------------------+-------------------+------------------------+------------------------------+--------------------+------------------------------------------------------------------------------------+----------------+------+------------+------------+
| Field                      | Type     | Null | Key | Default | Extra |
+----------------------------+----------+------+-----+---------+-------+
| Far_Id                     | int      | NO   | PRI | NULL    |       |
| Subject                    | longtext | YES  |     | NULL    |       |
| Status                     | longtext | NO   |     | NULL    |       |
| Created                    | longtext | NO   |     | NULL    |       |
| Expires                    | longtext | YES  |     | NULL    |       |
| Requested_Source           | longtext | NO   |     | NULL    |       |
| Requested_Destination      | longtext | NO   |     | NULL    |       |
| Requested_Service          | longtext | NO   |     | NULL    |       |
| Requested_Source_NAT       | longtext | YES  |     | NULL    |       |
| Requested_Destination_NAT  | longtext | YES  |     | NULL    |       |
| Requested_Port_Translation | longtext | YES  |     | NULL    |       |
| Change_Source              | longtext | YES  |     | NULL    |       |
| Change_Destination         | longtext | YES  |     | NULL    |       |
| Change_Service             | longtext | YES  |     | NULL    |       |
| Change_Source_NAT          | longtext | YES  |     | NULL    |       |
| Change_Destination_NAT     | longtext | YES  |     | NULL    |       |
| Translated_Destination     | longtext | YES  |     | NULL    |       |
| Translated_Service         | longtext | YES  |     | NULL    |       |
| Dependent_application      | longtext | YES  |     | NULL    |       |
| Permanent_Rule             | longtext | YES  |     | NULL    |       |
| ZONE                       | longtext | YES  |     | NULL    |       |
| Created_op                 | longtext | YES  |     | NULL    |       |
| Expires_op                 | longtext | YES  |     | NULL    |       |
+----------------------------+----------+------+-----+---------+-------+



enhanced_prompt = f"""
You are an expert SQL assistant. Generate a syntactically correct SQL query using only the `FarDetailsAll` table to answer the user's question.

# USER QUESTION:
{question}

# TABLE: FarDetailsAll

## FIELDS:
- Far_Id (INT, PRIMARY KEY)
- Subject (TEXT)
- Status (TEXT, NOT NULL)
- Created (TEXT, NOT NULL, contains datetime string)
- Expires (TEXT, may be NULL)
- Requested_Source (TEXT)
- Requested_Destination (TEXT)
- Requested_Service (TEXT)
- Requested_Source_NAT (TEXT)
- Requested_Destination_NAT (TEXT)
- Requested_Port_Translation (TEXT)
- Change_Source (TEXT)
- Change_Destination (TEXT)
- Change_Service (TEXT)
- Change_Source_NAT (TEXT)
- Change_Destination_NAT (TEXT)
- Translated_Destination (TEXT)
- Translated_Service (TEXT)
- Dependent_application (TEXT)
- Permanent_Rule (TEXT)
- ZONE (TEXT)
- Created_op (TEXT)
- Expires_op (TEXT)

## QUERY RULES:
1. Only use the table `FarDetailsAll`.
2. Return ONLY the SQL query (no explanation or extra text).
3. For **text filtering**, use `LIKE '%value%'`.
4. For **Far_Id** comparisons, use `Far_Id = value` (no quotes around numbers).
5. For **date/time comparisons**, wrap the date string in `STR_TO_DATE('YYYY-MM-DD', '%Y-%m-%d')` if needed.
6. If the query is NOT a `COUNT`, always add `LIMIT 50`.
7. Do NOT use JOINs or subqueries — single-table only.
8. Avoid quoting column names unless necessary.

## EXAMPLES:
- SELECT * FROM FarDetailsAll WHERE Far_Id = 175 LIMIT 50;
- SELECT Far_Id, Subject, Status FROM FarDetailsAll WHERE Status LIKE '%rejected%' AND ZONE LIKE '%UAT%' LIMIT 50;
- SELECT COUNT(*) FROM FarDetailsAll WHERE Subject LIKE '%EIS%' AND Status LIKE '%resolved%';

# TASK:
Write the SQL query to answer:
{question}
"""




❌ Database Error: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(`*`) from `FarDetailsAll` where `Far_Id` equals 272894, but there are only thre' at line 1")
SQL Query: select all columns (`*`) from `FarDetailsAll` where `Far_Id` equals 272894, but there are only three rows in the table with `Far_Id` values 175, 186, and 187, I will modify the query to return an empty result set. LIMIT 50
Original LLM output: 'Since the question is asking to select all columns (`*`) from `FarDetailsAll` where `Far_Id` equals 272894, but there are only three rows in the table with `Far_Id` values 175, 186, and 187, I will modify the query to return an empty result set.\n\nSQLQuery: SELECT * FROM FarDetailsAll WHERE Far_Id = 272894 LIMIT 5\n\nSince there is no row with `Far_Id` equal to 272894, the query will return an empty result set.'
Please check the query syntax and try again.
after output





enhanced_prompt = f"""
You are a SQL generator. Your task is to output ONLY a valid MySQL SQL query based on the input question. DO NOT output any explanation, comment, reasoning, or clarification. ONLY return the SQL statement.

# USER QUESTION:
{question}

# TABLE NAME:
FarDetailsAll

# TABLE COLUMNS:
- Far_Id (INT)
- Subject (TEXT)
- Status (TEXT)
- Created (TEXT - date/time string)
- Expires (TEXT)
- Requested_Source (TEXT)
- Requested_Destination (TEXT)
- Requested_Service (TEXT)
- Requested_Source_NAT (TEXT)
- Requested_Destination_NAT (TEXT)
- Requested_Port_Translation (TEXT)
- Change_Source (TEXT)
- Change_Destination (TEXT)
- Change_Service (TEXT)
- Change_Source_NAT (TEXT)
- Change_Destination_NAT (TEXT)
- Translated_Destination (TEXT)
- Translated_Service (TEXT)
- Dependent_application (TEXT)
- Permanent_Rule (TEXT)
- ZONE (TEXT)
- Created_op (TEXT)
- Expires_op (TEXT)

# RULES FOR SQL GENERATION:
1. Output ONLY the raw SQL query — no reasoning, no explanations.
2. Use correct MySQL syntax (e.g., SELECT ... FROM ... WHERE ...).
3. Use `LIKE '%value%'` for text filters.
4. Use `Far_Id = 123` for exact numeric match — no quotes for numbers.
5. Use `STR_TO_DATE('YYYY-MM-DD', '%Y-%m-%d')` for date comparisons if needed.
6. ALWAYS add `LIMIT 50` unless query uses COUNT.
7. NEVER return anything other than the SQL.

# EXAMPLES:
SELECT * FROM FarDetailsAll WHERE Far_Id = 175 LIMIT 50;
SELECT Far_Id, Status FROM FarDetailsAll WHERE Status LIKE '%resolved%' LIMIT 50;
SELECT COUNT(*) FROM FarDetailsAll WHERE ZONE LIKE '%UAT%';

# QUESTION:
{question}
"""

